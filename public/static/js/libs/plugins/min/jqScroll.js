(function(e){function b(){var n=f(navigator.userAgent);var m={};if(n.browser){m[n.browser]=true;m.version=n.version}if(m.chrome){m.webkit=true}else{if(m.webkit){m.safari=true}}return m}function f(m){m=m.toLowerCase();var n=/(chrome)[ \/]([\w.]+)/.exec(m)||/(webkit)[ \/]([\w.]+)/.exec(m)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(m)||/(msie) ([\w.]+)/.exec(m)||m.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(m)||[];return{browser:n[1]||"",version:n[2]||"0"}}function d(n,m){if(m){n.addClass("loading")}else{n.removeClass("loading")}}function j(n,o){var m=n%o;return(m!=0)?((n-m)/o)+1:n/o}function c(n,o){var m=n%o;return(m!=0)?(n-m)/o:n/o}function k(m){return m.replace(/[\.]/g," ").replace(/^\s+|\s+$|/g,"")}var i=e(window),h=e("html")[0],g=b(),a=(g.webkit)?e("body,document"):e("body,html");var l=function(o,m){var n={el:"",tag:"",classTag:"",pushclassTag:null,pushidTag:null,btn:"",url:"",tmpl:"",delay:400,total:60,frecuency:10,partial:true,limit:30,ajax:{},table:true,callback:{preLoad:null,load:null,show:null,success:null,render:null,error:null},stop:false};this.settings=e.extend(n,m);this.lmtScroll=0;this.whght=h.clientHeight;this.flagAjax=true;this.tmpl=null;this.el=(this.settings.el!="")?e(this.settings.el):o;this.btn=e(this.settings.btn);this.arquitect={regs:null,number:0};this.limit={};this.scroll={flag:true,currentScroll:1,totalScroll:j(this.settings.limit,this.settings.frecuency),current:1};this.calcLimit();this.$this=o;this.init();return this};l.prototype.init=function(){this.settings.callback.preLoad&&this.settings.callback.preLoad.call(this);this.construct();this.dispatchScroll();this.resize();this.scroll.flag=(this.settings.stop)?false:true;this.scrollize();this.settings.callback.load&&this.settings.callback.load(this)};l.prototype.calcLimit=function(){var o=this,n=j(o.settings.total,o.settings.limit),m=j((o.settings.total%o.settings.limit),o.settings.frecuency);o.limit={current:(n!=0)?n:1,currentScroll:(m!=0)?m:o.scroll.totalScroll}};l.prototype.construct=function(){var p=this,o=this.el,n=p.settings,m=p.arquitect;m.regs=e(n.tag+n.classTag,o);m.number=m.regs.length};l.prototype.dispatchScroll=function(){var t=this,r=t.settings,o=t.scroll,n=t.arquitect,s=(r.frecuency*o.currentScroll)+(r.limit*(o.current-1)),m,q,p;s=(s>r.total)?r.total:s;(o.currentScroll<o.totalScroll||(t.limit.current==t.scroll.current&&t.limit.currentScroll==t.scroll.currentScroll))?t.btn.hide():t.btn.show();if(o.currentScroll==1&&o.current==1){if(r.table){n.regs.not(":lt("+(s)+")").find("td").hide()}else{n.regs.not(":lt("+(s)+")").hide()}t.calposition()}else{m=0;p=(r.table)?n.regs.slice(0,s).find("td"):n.regs.slice(0,s);q=p.length;p.each(function(u,v){e(v).fadeIn(1000,function(){m=m+1;if(m==q){t.calposition()}});t.settings.callback.show&&t.settings.callback.show(t)})}};l.prototype.scrollize=function(){var p=this,n=p.settings,o,m;i.on("scroll",function(){o=a.scrollTop(),m=p.lmtScroll-p.whght;if(o>=m&&p.scroll.flag){p.scroll.flag=false;p.scroll.currentScroll=p.scroll.currentScroll+1;setTimeout(function(){p.dispatchScroll()},n.delay)}});p.btn.on("click",function(q){q.preventDefault();p.scroll.currentScroll=1;p.scroll.current=p.scroll.current+1;p.ajax(function(){p.dispatchScroll()})})};l.prototype.resize=function(){var m=this;i.on("resize",function(){m.whght=h.clientHeight})};l.prototype.calposition=function(){var o=this,n=o.$this,m=n.offset().top+n.height();o.lmtScroll=m;(o.scroll.currentScroll<o.scroll.totalScroll&&!(o.limit.current==o.scroll.current&&o.limit.currentScroll==o.scroll.currentScroll))?o.scroll.flag=true:""};l.prototype.ajax=function(p){var o=this,m=o.settings,n=o.convertData(m.ajax);d(o.btn,true);e.ajax({url:m.url,data:n,dataType:"json",type:"GET",success:function(r){d(o.btn,false);var q=m.callback.success&&m.callback.success(r)||r;o.render(q);p&&p()},error:function(q,s,r){d(o.btn,false);m.callback.error&&m.callback.error(q,s,r)}})};l.prototype.convertData=function(o){var p=this,m={};for(var n in o){m[n]=o[n]&&o[n](p)}return m};l.prototype.render=function(w){var s=this,n=s.el,q=s.settings,u=s.arquitect,m=k(q.classTag),r=null,p,v,o,t;s.tmpl=(s.tmpl==null)?_.template(e(q.tmpl).html()):s.tmpl;if(q.partial){_.each(w,function(x){v=q.pushclassTag&&q.pushclassTag(x)||"";p=e("<"+q.tag+"/>",{"class":m+" "+v});o=q.pushidTag&&q.pushidTag(x,p)||"";if(o!=""){p.attr("id",o)}p.append(s.tmpl(x));(q.table)?p.find("td").hide():p.hide();n.append(p);r=(r==null)?p:r.add(p)})}else{_.map(s.arquitect.regs,function(y,x){v=q.pushclassTag&&q.pushclassTag(w[x])||"";o=q.pushidTag&&q.pushidTag(w[x],e(y))||"";t=(q.table)?e(y).find("td").is(":hidden"):e(y).is(":hidden");if(o!=""){e(y).attr("id",o)}e(y).removeClass().addClass(v).html(s.tmpl(w[x]));if(t){(q.table)?e(y).find("td").hide():e(y).hide()}});_.each(w.slice(s.arquitect.regs.length,w.length),function(x){v=q.pushclassTag&&q.pushclassTag(x)||"";p=e("<"+q.tag+"/>",{"class":m+" "+v});o=q.pushidTag&&q.pushidTag(x,p)||"";if(o!=""){p.attr("id",o)}p.append(s.tmpl(x));(q.table)?p.find("td").hide():p.hide();n.append(p);r=(r==null)?p:r.add(p)})}u.regs=u.regs.add(r);u.number=u.regs.length;q.callback.render&&q.callback.render(r)};l.prototype.fetch=function(q,t){var r=this,o=r.settings,u=r.arquitect,w=(typeof t!="undefined")?t:o.total,m=(q.length<r.arquitect.regs.length)?true:false,p=(q.length>r.arquitect.regs.length)?true:false,s,v,n;r.tmpl=(r.tmpl==null)?_.template(e(o.tmpl).html()):r.tmpl;r.settings.total=w;r.calcLimit();_.map(q,function(y,x){if(e(r.arquitect.regs[x]).length>0){v=o.pushclassTag&&o.pushclassTag(y)||"";n=o.pushidTag&&o.pushidTag(y,e(r.arquitect.regs[x]))||"";s=(o.table)?e(r.arquitect.regs[x]).find("td").is(":hidden"):e(r.arquitect.regs[x]).is(":hidden");if(n!=""){e(r.arquitect.regs[x]).attr("id",n)}e(r.arquitect.regs[x]).removeClass().addClass(v).html(r.tmpl(y));if(s){(o.table)?e(r.arquitect.regs[x]).find("td").hide():e(r.arquitect.regs[x]).hide()}}});if(p){r.scrollReset();r.assing(q)}if(m){r.arquitect.regs.slice(q.length,r.arquitect.regs.length).remove();r.arquitect.regs=r.arquitect.regs.slice(0,q.length);r.btn.hide();r.scrollReset()}r.calposition()};l.prototype.stopScroll=function(m){var n=this;if(m){n.scroll.flag=false}else{n.calposition()}};l.prototype.scrollReset=function(){var s=this,p=s.settings,m=0,o;_.each(s.arquitect.regs,function(t){o=(p.table)?e(t).find("td").is(":hidden"):e(t).is(":hidden");if(!o){m=m+1}});var q=j(m,s.settings.limit),n=m%s.settings.limit,r;if(n==0){r=(m==0)?1:s.scroll.totalScroll}else{r=j(n,s.settings.frecuency)}s.scroll.currentScroll=r;s.scroll.current=(q==0)?1:q;(s.scroll.currentScroll<s.scroll.totalScroll||(s.limit.current==s.scroll.current&&s.limit.currentScroll==s.scroll.currentScroll))?s.btn.hide():s.btn.show()};l.prototype.assing=function(v){var w=this,o=w.el,s=w.settings,x=w.arquitect,r=w.arquitect.regs.length,n=v.length,u=(j(r,w.settings.frecuency)*w.settings.frecuency)-r,m=k(s.classTag),t=null,q,y,p;u=(u==0)?w.settings.frecuency:u;_.map(v.slice(r,n),function(A,z){y=s.pushclassTag&&s.pushclassTag(A)||"";q=e("<"+s.tag+"/>",{"class":m+" "+y});p=s.pushidTag&&s.pushidTag(A,q)||"";if(p!=""){q.attr("id",p)}q.append(w.tmpl(A));if(z>=u){(s.table)?q.find("td").hide():q.hide()}o.append(q);t=(t==null)?q:t.add(q)});x.regs=x.regs.add(t);x.number=x.regs.length};e.fn.Scrollaize=function(m){if(typeof m=="undefined"||m.constructor==Object){return new l(this,m)}else{if(typeof m!="undefined"&&m.constructor==String){l[m].apply(this,Array.prototype.slice.call(arguments,1))}else{e.error("El parametro proporcionado "+method+" esta mal declarado o no es un objeto")}}}})(jQuery,_);